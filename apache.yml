- name: Deploy Apache2 Static Website on Port 8081
  hosts: web
  become: yes

  tasks:
    - name: Install apache2
      apt:
        name: apache2
        state: present
        update_cache: yes

    - name: Change Apache listen port to 8081
      lineinfile:
        path: /etc/apache2/ports.conf
        regexp: '^Listen'
        line: 'Listen 8081'

    - name: Update default virtual host to 8081
      replace:
        path: /etc/apache2/sites-available/000-default.conf
        regexp: '<VirtualHost \*:80>'
        replace: '<VirtualHost *:8081>'

    - name: Copy website files
      copy:
        src: site/
        dest: /var/www/html/
        owner: www-data
        group: www-data
        mode: '0644'

    - name: Restart apache2
      service:
        name: apache2
        state: restarted
        enabled: yes
